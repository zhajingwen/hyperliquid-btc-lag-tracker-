# Beta ç³»æ•°æ³¨é‡Šå¤æ ¸æŠ¥å‘Š

## ğŸ“‹ å¤æ ¸ç›®æ ‡

ç¡®ä¿ä»£ç ä¸­å‡†ç¡®åŒºåˆ†ä¸¤ç§ Betaï¼š
1. **Beta æ”¶ç›Šç‡ç³»æ•°**ï¼ˆåŸºäºæ”¶ç›Šç‡ï¼‰
2. **Beta ç³»æ•°**ï¼ˆåŸºäºå¯¹æ•°ä»·æ ¼ï¼‰

---

## âœ… å¤æ ¸ç»“æœï¼šå®Œå…¨å‡†ç¡®

### ğŸ¯ ä¸¤ç§ Beta çš„å®šä¹‰

| ç±»å‹ | å‡½æ•° | è¾“å…¥æ•°æ® | å…¬å¼ | ç”¨é€” |
|------|------|---------|------|------|
| **Beta æ”¶ç›Šç‡ç³»æ•°** | `_calculate_beta()` | æ”¶ç›Šç‡åºåˆ— | `Î² = Cov(BTC_returns, ALT_returns) / Var(BTC_returns)` | æ³¢åŠ¨ç‡åˆ†æã€é£é™©è¯„ä¼°ã€äº¤æ˜“å¯¹ç­›é€‰ |
| **Beta å¯¹æ•°ä»·æ ¼ç³»æ•°** | `_calculate_beta_from_prices()` | ä»·æ ¼åºåˆ— | `Î² = Cov(log_BTC, log_ALT) / Var(log_BTC)` | ä»·å·®æ„å»ºã€Z-score è®¡ç®— |

---

## ğŸ“ å…³é”®ä½ç½®éªŒè¯

### 1. ç±»é…ç½®åŒºåŸŸï¼ˆè¡Œ134-143ï¼‰âœ…
```python
# ========== æ–°å¢ï¼šBeta æ”¶ç›Šç‡ç³»æ•°é…ç½® ==========
# Beta æ”¶ç›Šç‡ç³»æ•°ï¼šåŸºäº BTC å’Œå±±å¯¨å¸æ”¶ç›Šç‡è®¡ç®—
# å…¬å¼ï¼šÎ² = Cov(BTC_returns, ALT_returns) / Var(BTC_returns)
ENABLE_BETA_CALCULATION = True
MIN_POINTS_FOR_BETA_CALC = 10
AVG_BETA_THRESHOLD = 1
```
**éªŒè¯ç»“æœ**ï¼šâœ… æ­£ç¡® - è¿™äº›é…ç½®ç”¨äºæ”¶ç›Šç‡Betaçš„è®¡ç®—å’Œç­›é€‰

---

### 2. BETA_WINDOW é…ç½®ï¼ˆè¡Œ151-156ï¼‰âœ…
```python
# ========== åŒçª—å£ç­–ç•¥é…ç½® ==========
# Beta ç³»æ•°è®¡ç®—çª—å£ï¼ˆé•¿æœŸå…³ç³»çª—å£ï¼Œç”¨äº Z-score ä»·å·®æ„å»ºï¼‰
# ç›®çš„ï¼šä½¿ç”¨æ›´é•¿çª—å£è®¡ç®—åŸºäºå¯¹æ•°ä»·æ ¼çš„ Beta
# ç”¨äºæ„å»ºä»·å·®åºåˆ—ï¼šspread = log(ALT) - Î² Ã— log(BTC)
BETA_WINDOW = 100
```
**éªŒè¯ç»“æœ**ï¼šâœ… æ­£ç¡® - ç”¨äºå¯¹æ•°ä»·æ ¼Betaï¼ˆZ-scoreè®¡ç®—ï¼‰

**ä¿®æ­£å‰**ï¼šâŒ é”™è¯¯åœ°å†™ä¸º"Beta æ”¶ç›Šç‡ç³»æ•°è®¡ç®—çª—å£"
**ä¿®æ­£å**ï¼šâœ… å‡†ç¡®è¯´æ˜ç”¨äºå¯¹æ•°ä»·æ ¼Beta

---

### 3. _calculate_beta() å‡½æ•°ï¼ˆè¡Œ382-410ï¼‰âœ…
```python
def _calculate_beta(btc_ret, alt_ret, coin: str = None):
    """
    è®¡ç®— Beta æ”¶ç›Šç‡ç³»æ•°
    
    åŸºäºæ”¶ç›Šç‡åºåˆ—è®¡ç®— Beta ç³»æ•°ï¼Œè¡¡é‡å±±å¯¨å¸æ”¶ç›Šç‡ç›¸å¯¹ BTC æ”¶ç›Šç‡çš„æ³¢åŠ¨å¹…åº¦ã€‚
    å…¬å¼ï¼šÎ² = Cov(BTC_returns, ALT_returns) / Var(BTC_returns)
    """
```
**éªŒè¯ç»“æœ**ï¼šâœ… å®Œå…¨æ­£ç¡® - è¾“å…¥æ˜¯æ”¶ç›Šç‡ï¼Œè¾“å‡ºæ˜¯æ”¶ç›Šç‡Beta

---

### 4. _calculate_beta_from_prices() å‡½æ•°ï¼ˆè¡Œ515-549ï¼‰âœ…
```python
def _calculate_beta_from_prices(btc_prices, alt_prices, coin: str = None):
    """
    åŸºäºå¯¹æ•°ä»·æ ¼è®¡ç®— Beta ç³»æ•°ï¼ˆå…¨æ ·æœ¬è®¡ç®—ï¼‰
    
    å…¬å¼ï¼šÎ² = Cov(log_BTC_prices, log_ALT_prices) / Var(log_BTC_prices)
    
    ä¸ _calculate_beta() çš„åŒºåˆ«ï¼š
    - _calculate_beta()ï¼šåŸºäºæ”¶ç›Šç‡åºåˆ—ï¼Œç”¨äºæ³¢åŠ¨ç‡åˆ†æå’Œé£é™©è¯„ä¼°
    - _calculate_beta_from_prices()ï¼šåŸºäºå¯¹æ•°ä»·æ ¼åºåˆ—ï¼Œç”¨äºåæ•´å…³ç³»å’Œä»·å·®æ„å»º
    
    åº”ç”¨åœºæ™¯ï¼š
    - Z-score è®¡ç®—ï¼šç”¨äºæ„å»ºå¯¹æ•°ä»·å·®åºåˆ— spread = log(ALT) - Î² Ã— log(BTC)
    """
```
**éªŒè¯ç»“æœ**ï¼šâœ… å®Œå…¨æ­£ç¡® - æ˜ç¡®åŒºåˆ†äº†ä¸¤ç§Betaçš„ç”¨é€”

---

### 5. Z-score è®¡ç®—å‡½æ•°ï¼ˆè¡Œ721-777ï¼‰âœ…
```python
# 1. å‚æ•°å¤„ç†ï¼šbeta_window é»˜è®¤ä½¿ç”¨ç±»å±æ€§ BETA_WINDOW
# Beta ç³»æ•°ï¼ˆåŸºäºå¯¹æ•°ä»·æ ¼ï¼‰ä½¿ç”¨é•¿çª—å£ï¼Œç”¨äºæ„å»ºç¨³å®šçš„ä»·å·®åºåˆ—
# Z-score ç»Ÿè®¡é‡ä½¿ç”¨çŸ­çª—å£ï¼Œæé«˜å¯¹ä»·æ ¼åç¦»çš„å“åº”æ€§

# 5. Beta ç³»æ•°è®¡ç®—ï¼ˆé•¿çª—å£ï¼ŒåŸºäºå¯¹æ•°ä»·æ ¼ï¼‰
# å…¬å¼ï¼šÎ² = Cov(log_BTC, log_ALT) / Var(log_BTC)
# ç”¨é€”ï¼šæ„å»ºä»·å·®åºåˆ— spread = log(ALT) - Î² Ã— log(BTC)
rolling_beta = DelayCorrelationAnalyzer._calculate_beta_from_prices(
    beta_btc, beta_alt, coin=coin
)
```
**éªŒè¯ç»“æœ**ï¼šâœ… æ­£ç¡® - è°ƒç”¨å¯¹æ•°ä»·æ ¼Betaå‡½æ•°ï¼Œç”¨äºä»·å·®æ„å»º

**ä¿®æ­£å‰**ï¼šâŒ é”™è¯¯åœ°å†™ä¸º"Beta æ”¶ç›Šç‡ç³»æ•°è®¡ç®—"
**ä¿®æ­£å**ï¼šâœ… å‡†ç¡®è¯´æ˜æ˜¯å¯¹æ•°ä»·æ ¼Beta

---

### 6. _find_optimal_delay() å‡½æ•°ï¼ˆè¡Œ1179-1205ï¼‰âœ…
```python
# ========== 4. è®¡ç®— Beta æ”¶ç›Šç‡ç³»æ•°ï¼ˆå¦‚æœå¯ç”¨ï¼‰==========
# åŸºäºæ”¶ç›Šç‡åºåˆ—è®¡ç®— Betaï¼Œè¡¡é‡å±±å¯¨å¸ç›¸å¯¹ BTC çš„æ³¢åŠ¨å¹…åº¦
# å…¬å¼ï¼šÎ² = Cov(BTC_returns, ALT_returns) / Var(BTC_returns)
beta = None
if enable_beta_calc:
    # æ ¹æ®æœ€ä¼˜å»¶è¿Ÿé€‰æ‹©æ•°æ®å¯¹é½æ–¹å¼
    if tau_star > 0:
        btc_beta = btc_ret_processed[:-tau_star]
        alt_beta = alt_ret_processed[tau_star:]
    else:
        btc_beta = btc_ret_processed
        alt_beta = alt_ret_processed
    
    beta = DelayCorrelationAnalyzer._calculate_beta(
        btc_beta[:m_beta],
        alt_beta[:m_beta],
        coin=coin
    )
```
**éªŒè¯ç»“æœ**ï¼šâœ… å®Œå…¨æ­£ç¡® - ä½¿ç”¨æ”¶ç›Šç‡æ•°æ®ï¼Œè°ƒç”¨æ”¶ç›Šç‡Betaå‡½æ•°

---

### 7. æ•°æ®æµéªŒè¯ï¼ˆè¡Œ1357-1375ï¼‰âœ…
```python
# _analyze_single_combination å‡½æ•°ä¸­ï¼š
tau_star, _, related_matrix, beta = self.find_optimal_delay(
    btc_df_aligned['return'].values,  # âœ… ä¼ å…¥æ”¶ç›Šç‡æ•°æ®
    alt_df_aligned['return'].values,   # âœ… ä¼ å…¥æ”¶ç›Šç‡æ•°æ®
    coin=coin
)

return (related_matrix, timeframe, period, tau_star, beta)
# âœ… è¿”å›çš„ beta æ˜¯æ”¶ç›Šç‡Beta
```
**éªŒè¯ç»“æœ**ï¼šâœ… æ•°æ®æµæ­£ç¡® - æ”¶ç›Šç‡ â†’ æ”¶ç›Šç‡Beta

---

### 8. Beta æ£€æŸ¥ä¸è¿‡æ»¤ï¼ˆè¡Œ1410-1434ï¼‰âœ…
```python
# ========== Beta æ”¶ç›Šç‡ç³»æ•°æ£€æŸ¥ ==========
# ä» results ä¸­æå–æ‰€æœ‰æœ‰æ•ˆçš„ Beta æ”¶ç›Šç‡ç³»æ•°å€¼
# Beta æ”¶ç›Šç‡ç³»æ•°ï¼šåŸºäºæ”¶ç›Šç‡è®¡ç®—ï¼Œè¡¡é‡å±±å¯¨å¸ç›¸å¯¹ BTC çš„æ³¢åŠ¨å¹…åº¦
# ç”¨äºè¿‡æ»¤æ³¢åŠ¨ä¸è¶³çš„äº¤æ˜“å¯¹ï¼ˆÎ² < é˜ˆå€¼ï¼‰ï¼Œç¡®ä¿æœ‰è¶³å¤Ÿå¥—åˆ©ç©ºé—´
```
**éªŒè¯ç»“æœ**ï¼šâœ… æ­£ç¡® - è¿™é‡Œæ¥æ”¶çš„æ˜¯æ¥è‡ª find_optimal_delay çš„æ”¶ç›Šç‡Beta

---

### 9. å‘Šè­¦è¾“å‡ºï¼ˆè¡Œ1534-1557ï¼‰âœ…
```python
# æ·»åŠ  Beta æ”¶ç›Šç‡ç³»æ•°åˆ—ï¼ˆå¦‚æœå­˜åœ¨ä¸”æœ‰æ•ˆï¼‰
if beta is not None and not np.isnan(beta):
    row['Betaæ”¶ç›Šç‡ç³»æ•°'] = beta  # âœ… æ­£ç¡®å‘½å
    has_beta = True

# å¦‚æœæœ‰ Beta æ”¶ç›Šç‡ç³»æ•°ä¿¡æ¯ï¼Œæ·»åŠ é£é™©æç¤º
if has_beta:
    avg_beta = df_results['Betaæ”¶ç›Šç‡ç³»æ•°'].mean()  # âœ… æ­£ç¡®å‘½å
    content += f"\nBetaæ”¶ç›Šç‡ç³»æ•°: {avg_beta:.2f}"  # âœ… æ­£ç¡®å‘½å
```
**éªŒè¯ç»“æœ**ï¼šâœ… å®Œå…¨æ­£ç¡® - DataFrameå’Œå‘Šè­¦éƒ½ä½¿ç”¨"Betaæ”¶ç›Šç‡ç³»æ•°"

**æ•°æ®æ¥æºç¡®è®¤**ï¼šè¿™äº›betaå€¼æ¥è‡ª `_analyze_single_combination` â†’ `find_optimal_delay` â†’ `_calculate_beta(æ”¶ç›Šç‡)`ï¼Œç¡®å®æ˜¯æ”¶ç›Šç‡Beta

---

## ğŸ”„ ä¿®æ­£å†å²

### ç¬¬ä¸€è½®ä¿®æ­£ï¼ˆåˆå§‹ä¼˜åŒ–ï¼‰
- âœ… ä¼˜åŒ–äº† `_calculate_beta()` å‡½æ•°æ–‡æ¡£
- âœ… ä¼˜åŒ–äº† `_calculate_beta_from_prices()` å‡½æ•°æ–‡æ¡£
- âœ… æ·»åŠ äº†è¯¦ç»†çš„åº”ç”¨åœºæ™¯è¯´æ˜
- âš ï¸ ä½†è¯¯å°†å¯¹æ•°ä»·æ ¼Betaçš„æ³¨é‡Šå†™æˆäº†"æ”¶ç›Šç‡Beta"

### ç¬¬äºŒè½®ä¿®æ­£ï¼ˆç”¨æˆ·æŒ‡å‡ºé”™è¯¯ï¼‰
- âœ… ä¿®æ­£è¡Œ723ï¼šZ-scoreå‡½æ•°ä¸­çš„Betaæ³¨é‡Š
- âœ… ä¿®æ­£è¡Œ760-763ï¼šBetaè®¡ç®—æ³¨é‡Š
- âœ… ä¿®æ­£è¡Œ910-913ï¼šBetaè®¡ç®—æ³¨é‡Š  
- âœ… ä¿®æ­£è¡Œ1749ï¼šå‡½æ•°è°ƒç”¨æ³¨é‡Š

### ç¬¬ä¸‰è½®ä¿®æ­£ï¼ˆæœ¬æ¬¡å¤æ ¸ï¼‰
- âœ… ä¿®æ­£è¡Œ152-153ï¼šBETA_WINDOW é…ç½®æ³¨é‡Š
- âœ… ç¡®è®¤æ‰€æœ‰å…¶ä»–æ³¨é‡Šå‡†ç¡®æ— è¯¯

---

## âœ… æœ€ç»ˆç»“è®º

### å®Œå…¨å‡†ç¡®çš„æ³¨é‡Šåˆ†ç±»

#### ä½¿ç”¨"Beta æ”¶ç›Šç‡ç³»æ•°"çš„ä½ç½®ï¼ˆå…¨éƒ¨æ­£ç¡®ï¼‰âœ…
1. è¡Œ134-143ï¼šç±»é…ç½®ï¼ˆ`ENABLE_BETA_CALCULATION`, `AVG_BETA_THRESHOLD`ï¼‰
2. è¡Œ385ï¼š`_calculate_beta()` å‡½æ•°æ ‡é¢˜
3. è¡Œ1179ï¼š`_find_optimal_delay()` ä¸­çš„Betaè®¡ç®—
4. è¡Œ1410ï¼š`_analyze_single_group()` ä¸­çš„Betaæ£€æŸ¥
5. è¡Œ1534-1557ï¼šå‘Šè­¦è¾“å‡ºä¸­çš„DataFrameåˆ—åå’Œæ¶ˆæ¯

#### ä½¿ç”¨"Beta ç³»æ•°ï¼ˆåŸºäºå¯¹æ•°ä»·æ ¼ï¼‰"çš„ä½ç½®ï¼ˆå…¨éƒ¨æ­£ç¡®ï¼‰âœ…
1. è¡Œ152ï¼š`BETA_WINDOW` é…ç½®
2. è¡Œ517ï¼š`_calculate_beta_from_prices()` å‡½æ•°æ ‡é¢˜
3. è¡Œ723ï¼š`_calculate_zscore()` ä¸­çš„æ³¨é‡Š
4. è¡Œ760ï¼šBetaè®¡ç®—æ³¨é‡Š
5. è¡Œ910ï¼šBetaè®¡ç®—æ³¨é‡Š

### éªŒè¯é€šè¿‡ âœ…

æ‰€æœ‰æ³¨é‡Šç°åœ¨éƒ½å‡†ç¡®åŒ¹é…ï¼š
- âœ… æ”¶ç›Šç‡æ•°æ® â†’ ä½¿ç”¨"Beta æ”¶ç›Šç‡ç³»æ•°"æ³¨é‡Š
- âœ… ä»·æ ¼æ•°æ® â†’ ä½¿ç”¨"Beta ç³»æ•°ï¼ˆåŸºäºå¯¹æ•°ä»·æ ¼ï¼‰"æ³¨é‡Š
- âœ… å‡½æ•°è°ƒç”¨ä¸æ³¨é‡Šå®Œå…¨åŒ¹é…
- âœ… æ•°æ®æµå‘æ¸…æ™°å‡†ç¡®
- âœ… ç”¨é€”è¯´æ˜å‡†ç¡®æ— æ­§ä¹‰

## ğŸ“Š ä»£ç è´¨é‡

- âœ… æ—  linter é”™è¯¯
- âœ… æ³¨é‡Šæ¸…æ™°ã€å‡†ç¡®ã€å®Œæ•´
- âœ… æ¦‚å¿µåŒºåˆ†æ˜ç¡®
- âœ… æ‰€æœ‰ä¿®æ”¹å·²ä¿å­˜

