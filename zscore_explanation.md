# Z-scoreï¼ˆæ ‡å‡†åˆ†æ•°ï¼‰è¯¦è§£

**Z-score** æ˜¯ç»Ÿè®¡å­¦ä¸­ç”¨äºè¡¡é‡**æŸä¸ªæ•°å€¼åç¦»å¹³å‡å€¼å¤šå°‘ä¸ªæ ‡å‡†å·®**çš„æ ‡å‡†åŒ–æŒ‡æ ‡ã€‚

---

## ğŸ“ åŸºæœ¬æ¦‚å¿µ

### å…¬å¼
```
Z = (X - Î¼) / Ïƒ

å…¶ä¸­ï¼š
- X  = è§‚æµ‹å€¼
- Î¼  = å¹³å‡å€¼ï¼ˆå‡å€¼ï¼‰
- Ïƒ  = æ ‡å‡†å·®
- Z  = Z-scoreï¼ˆæ ‡å‡†åˆ†æ•°ï¼‰
```

### å«ä¹‰
- **Z = 0**ï¼šè§‚æµ‹å€¼ç­‰äºå¹³å‡å€¼
- **Z = 1**ï¼šè§‚æµ‹å€¼æ¯”å¹³å‡å€¼é«˜1ä¸ªæ ‡å‡†å·®
- **Z = -2**ï¼šè§‚æµ‹å€¼æ¯”å¹³å‡å€¼ä½2ä¸ªæ ‡å‡†å·®
- **|Z| > 2**ï¼šé€šå¸¸è¢«è®¤ä¸ºæ˜¯"å¼‚å¸¸å€¼"ï¼ˆåœ¨æ­£æ€åˆ†å¸ƒä¸­ï¼Œ99.7%çš„æ•°æ®è½åœ¨Â±3ÏƒèŒƒå›´å†…ï¼‰

---

## ğŸ’¡ åœ¨æœ¬é¡¹ç›®ä¸­çš„åº”ç”¨åœºæ™¯

ç»“åˆå½“å‰çš„é‡åŒ–åˆ†æä»£ç ï¼ˆhyperliquid_analyzer.pyï¼‰ï¼ŒZ-scoreå¯ä»¥è¿™æ ·åº”ç”¨ï¼š

### å½“å‰çš„ç›¸å…³ç³»æ•°åˆ†æï¼ˆç°æœ‰æ–¹æ³•ï¼‰
```python
# å½“å‰é€»è¾‘ï¼šåˆ¤æ–­ç›¸å…³æ€§å·®å¼‚
long_term_corr = 0.75  # 7å¤©ç›¸å…³ç³»æ•°
short_term_corr = 0.35  # 1å¤©ç›¸å…³ç³»æ•°
diff = 0.40  # å·®å€¼

# é—®é¢˜ï¼šæ— æ³•é‡åŒ–"ä»·æ ¼åç¦»"çš„ç¨‹åº¦
```

### å¼•å…¥Z-scoreåï¼ˆä¼˜åŒ–å»ºè®®ï¼‰
```python
# 1. æ„å»ºä»·å·®åºåˆ—ï¼ˆSpreadï¼‰
spread = alt_price - beta * btc_price

# 2. è®¡ç®—Z-score
z_score = (spread - spread.mean()) / spread.std()

# 3. è§£è¯»Z-score
if z_score > 2:
    # å±±å¯¨å¸å½“å‰ä»·æ ¼"è¿‡é«˜"ï¼Œåç¦»å‡è¡¡å…³ç³»2ä¸ªæ ‡å‡†å·®
    # é¢„æœŸï¼šä»·æ ¼ä¼šå›å½’ï¼Œå±±å¯¨å¸å¯èƒ½ä¸‹è·Œ

elif z_score < -2:
    # å±±å¯¨å¸å½“å‰ä»·æ ¼"è¿‡ä½"ï¼Œåç¦»å‡è¡¡å…³ç³»2ä¸ªæ ‡å‡†å·®
    # é¢„æœŸï¼šä»·æ ¼ä¼šå›å½’ï¼Œå±±å¯¨å¸å¯èƒ½ä¸Šæ¶¨
```

---

## ğŸ¯ å®é™…ä¾‹å­ï¼ˆåŸºäºæœ¬é¡¹ç›®ï¼‰

å‡è®¾åˆ†æ **DOGE/USDC** ä¸ **BTC/USDC** çš„å…³ç³»ï¼š

```python
# å†å²æ•°æ®ï¼ˆæœ€è¿‘20ä¸ª5åˆ†é’ŸKçº¿ï¼‰
æ—¶é—´     BTCä»·æ ¼   DOGEä»·æ ¼   ä»·å·®(spread)
--------------------------------------------
10:00    42000     0.085      0.0850
10:05    42100     0.086      0.0861
10:10    42200     0.087      0.0872
...
11:30    43000     0.095      0.0952  â† å½“å‰ä»·æ ¼

# è®¡ç®—
å¹³å‡ä»·å·®(Î¼) = 0.0880
æ ‡å‡†å·®(Ïƒ)   = 0.0035

å½“å‰ä»·å·® = 0.0952
Z-score = (0.0952 - 0.0880) / 0.0035 = 2.06
```

**è§£è¯»**ï¼š
- Z-score = 2.06 > 2ï¼Œè¯´æ˜ **DOGEå½“å‰ä»·æ ¼ç›¸å¯¹BTCåé«˜**
- åŸºäºå‡å€¼å›å½’ç†è®ºï¼ŒDOGEä»·æ ¼å¯èƒ½ä¼šä¸‹è·Œ
- **å¥—åˆ©ä¿¡å·**ï¼šåšç©ºDOGE/åšå¤šBTCï¼ˆä»·å·®å›å½’ç­–ç•¥ï¼‰

---

## ğŸ” Z-score vs ç›¸å…³ç³»æ•°ï¼ˆåŒºåˆ«ï¼‰

| æŒ‡æ ‡ | ç›¸å…³ç³»æ•°ï¼ˆPearsonï¼‰ | Z-score |
|------|-------------------|---------|
| **è¡¡é‡å¯¹è±¡** | ä¸¤ä¸ªå˜é‡çš„çº¿æ€§å…³ç³»å¼ºåº¦ | å•ä¸ªæ•°å€¼åç¦»å‡å€¼çš„ç¨‹åº¦ |
| **å–å€¼èŒƒå›´** | -1 åˆ° +1 | -âˆ åˆ° +âˆ |
| **åº”ç”¨åœºæ™¯** | åˆ¤æ–­BTCå’Œå±±å¯¨å¸æ˜¯å¦åŒæ­¥æ³¢åŠ¨ | åˆ¤æ–­å½“å‰ä»·æ ¼æ˜¯å¦åç¦»å‡è¡¡ |
| **åœ¨æœ¬é¡¹ç›®ä¸­çš„ä½œç”¨** | è¯†åˆ«é•¿æœŸè·Ÿéšå…³ç³»ï¼ˆåæ•´ï¼‰ | è¯†åˆ«å½“å‰å¥—åˆ©æ—¶æœºï¼ˆå…¥åœºç‚¹ï¼‰ |

---

## ğŸ¨ å¯è§†åŒ–ç¤ºä¾‹

```
æ­£æ€åˆ†å¸ƒä¸‹çš„Z-scoreï¼š

          -3Ïƒ    -2Ïƒ    -1Ïƒ    Î¼     +1Ïƒ    +2Ïƒ    +3Ïƒ
           |      |      |     |      |      |      |
ä»·å·® â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
           â–¼                           â–¼
        è¿‡åº¦ä½ä¼°                    è¿‡åº¦é«˜ä¼°
        (åšå¤šä¿¡å·)                  (åšç©ºä¿¡å·)

99.7%çš„æ•°æ®è½åœ¨Â±3Ïƒå†…
95.0%çš„æ•°æ®è½åœ¨Â±2Ïƒå†…  â† å¸¸ç”¨çš„å¼‚å¸¸é˜ˆå€¼
68.3%çš„æ•°æ®è½åœ¨Â±1Ïƒå†…
```

---

## ğŸ’¼ åœ¨æœ¬é¡¹ç›®ä¸­çš„é›†æˆå»ºè®®

åŸºäºå½“å‰çš„ `_detect_anomaly_pattern` æ–¹æ³•ï¼ˆhyperliquid_analyzer.py:621-683ï¼‰ï¼Œå¯ä»¥è¿™æ ·å¢å¼ºï¼š

```python
def _detect_anomaly_pattern(self, results: list, btc_df, alt_df) -> tuple:
    """å¢å¼ºç‰ˆï¼šç»“åˆç›¸å…³ç³»æ•°å’ŒZ-score"""

    # 1. ç°æœ‰é€»è¾‘ï¼šæ£€æŸ¥è·¨å‘¨æœŸç›¸å…³æ€§ç ´è£‚
    is_anomaly, diff_amount, ... = self._check_correlation_pattern(results)

    if is_anomaly:
        # 2. æ–°å¢ï¼šè®¡ç®—å½“å‰ä»·å·®çš„Z-score
        zscore = self._calculate_zscore(btc_df['Close'], alt_df['Close'])

        # 3. ç»„åˆåˆ¤æ–­ï¼šç›¸å…³æ€§ç ´è£‚ + ä»·å·®åç¦»
        if abs(zscore.iloc[-1]) > 2:
            # æ—¢æœ‰é•¿æœŸè·Ÿéšå…³ç³»ï¼Œåˆæœ‰å½“å‰ä»·æ ¼åç¦»
            # å¥—åˆ©ä¿¡å·æ›´å¼ºï¼
            return True, diff_amount, zscore.iloc[-1]

    return False, 0, 0
```

---

## ğŸ“Œ æ€»ç»“

### Z-scoreçš„æ ¸å¿ƒä»·å€¼

1. **é‡åŒ–åç¦»ç¨‹åº¦**ï¼šä¸åªæ˜¯"æœ‰å·®å¼‚"ï¼Œè€Œæ˜¯"å·®äº†å¤šå°‘"
2. **æ ‡å‡†åŒ–æ¯”è¾ƒ**ï¼šå¯ä»¥è·¨å¸ç§æ¯”è¾ƒï¼ˆDOGEçš„Z=2 vs ETHçš„Z=1.5ï¼‰
3. **åŠ¨æ€é˜ˆå€¼**ï¼šè‡ªåŠ¨é€‚åº”æ¯ä¸ªå¸ç§çš„æ³¢åŠ¨ç‰¹æ€§
4. **å…¥åœºæ—¶æœº**ï¼šå½“å‰ä»£ç èƒ½æ‰¾åˆ°"å“ªäº›å¸æœ‰æœºä¼š"ï¼ŒZ-scoreèƒ½æ‰¾åˆ°"ä½•æ—¶å…¥åœº"

### å®Œæ•´çš„ç»Ÿè®¡å¥—åˆ©æ¡†æ¶

é…åˆç°æœ‰çš„ç›¸å…³ç³»æ•°åˆ†æï¼Œå¯ä»¥æ„å»ºæ›´å®Œæ•´çš„å¥—åˆ©ç­–ç•¥ï¼š

- **ç›¸å…³ç³»æ•°** â†’ ç­›é€‰å€™é€‰å¸ç§ï¼ˆé•¿æœŸè·ŸéšBTCï¼‰
- **Z-score** â†’ ç¡®å®šäº¤æ˜“æ—¶æœºï¼ˆå½“å‰ä»·æ ¼åç¦»ï¼‰
- **Betaç³»æ•°** â†’ è¯„ä¼°é£é™©ï¼ˆæ³¢åŠ¨å¹…åº¦ï¼‰

è¿™ä¸‰ä¸ªæŒ‡æ ‡ç»“åˆï¼Œå°±æ˜¯å®Œæ•´çš„ç»Ÿè®¡å¥—åˆ©æ¡†æ¶ï¼

---

## ğŸ”§ å®ç°ç¤ºä¾‹ä»£ç 

```python
@staticmethod
def _calculate_zscore(btc_prices, alt_prices, beta, window=20):
    """
    è®¡ç®—ä»·å·®çš„Z-score

    Args:
        btc_prices: BTCä»·æ ¼åºåˆ—ï¼ˆpandas Seriesï¼‰
        alt_prices: å±±å¯¨å¸ä»·æ ¼åºåˆ—ï¼ˆpandas Seriesï¼‰
        beta: Betaç³»æ•°ï¼ˆå·²ç”±_calculate_betaè®¡ç®—ï¼‰
        window: rollingçª—å£å¤§å°ï¼ˆé»˜è®¤20ï¼‰

    Returns:
        pandas Series: Z-scoreåºåˆ—
    """
    # 1. æ„å»ºä»·å·®åºåˆ—
    spread = alt_prices - beta * btc_prices

    # 2. è®¡ç®—rollingå‡å€¼å’Œæ ‡å‡†å·®
    spread_mean = spread.rolling(window=window).mean()
    spread_std = spread.rolling(window=window).std()

    # 3. è®¡ç®—Z-score
    zscore = (spread - spread_mean) / spread_std

    return zscore


def _check_zscore_signal(self, btc_df, alt_df, beta, threshold=2.0):
    """
    æ£€æŸ¥Z-scoreæ˜¯å¦è§¦å‘äº¤æ˜“ä¿¡å·

    Args:
        btc_df: BTCæ•°æ®DataFrame
        alt_df: å±±å¯¨å¸æ•°æ®DataFrame
        beta: Betaç³»æ•°
        threshold: Z-scoreé˜ˆå€¼ï¼ˆé»˜è®¤2.0ï¼‰

    Returns:
        tuple: (is_signal, zscore_value, signal_type)
            - is_signal: æ˜¯å¦è§¦å‘ä¿¡å·
            - zscore_value: å½“å‰Z-scoreå€¼
            - signal_type: "åšç©º" æˆ– "åšå¤š" æˆ– None
    """
    zscore = self._calculate_zscore(
        btc_df['Close'],
        alt_df['Close'],
        beta
    )

    current_zscore = zscore.iloc[-1]

    if np.isnan(current_zscore):
        return False, None, None

    if current_zscore > threshold:
        return True, current_zscore, "åšç©º"
    elif current_zscore < -threshold:
        return True, current_zscore, "åšå¤š"
    else:
        return False, current_zscore, None
```

---

## ğŸ“ å»¶ä¼¸é˜…è¯»

### ç›¸å…³æ¦‚å¿µ

- **å‡å€¼å›å½’ï¼ˆMean Reversionï¼‰**ï¼šä»·æ ¼åç¦»å‡å€¼åä¼šå›å½’çš„ç†è®ºåŸºç¡€
- **åæ•´ç†è®ºï¼ˆCointegrationï¼‰**ï¼šéªŒè¯ä¸¤ä¸ªä»·æ ¼åºåˆ—æ˜¯å¦å­˜åœ¨é•¿æœŸå‡è¡¡å…³ç³»
- **Pairs Tradingï¼ˆé…å¯¹äº¤æ˜“ï¼‰**ï¼šåŸºäºZ-scoreçš„ç»å…¸é‡åŒ–ç­–ç•¥

### æ³¨æ„äº‹é¡¹

1. **æ•°æ®é‡è¦æ±‚**ï¼šrolling windowéœ€è¦è¶³å¤Ÿçš„å†å²æ•°æ®ï¼ˆå»ºè®®â‰¥100ä¸ªæ•°æ®ç‚¹ï¼‰
2. **çª—å£é€‰æ‹©**ï¼šwindowå¤ªå°å®¹æ˜“äº§ç”Ÿå™ªå£°ä¿¡å·ï¼Œå¤ªå¤§åˆ™ååº”æ»å
3. **éå¹³ç¨³æ€§**ï¼šå¦‚æœä»·å·®åºåˆ—éå¹³ç¨³ï¼Œéœ€è¦å…ˆè¿›è¡Œåæ•´æ£€éªŒ
4. **æç«¯å¸‚åœº**ï¼šåœ¨å‰§çƒˆæ³¢åŠ¨çš„å¸‚åœºä¸­ï¼ŒZ-scoreå¯èƒ½å¤±æ•ˆ

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0
**åˆ›å»ºæ—¥æœŸ**ï¼š2025-12-26
**é€‚ç”¨é¡¹ç›®**ï¼šHyperliquid BTC æ»åæ€§è¿½è¸ªå™¨
